(function(){tinymce.PluginManager.requireLangPack("syntaxhl");tinymce.create("tinymce.plugins.SyntaxHL",{init:function(a,b){var c=this;c.editor=a;c.url=b;function d(e){return/^(wysiwyg-syntaxhl)/.test(e.className)}a.addCommand("mceSyntaxHL",function(){a.windowManager.open({file:b+"/dialog.php?path="+escape(tinyMCE.baseURL)+"&random="+Math.random(),width:450+parseInt(a.getLang("syntaxhl.delta_width",0)),height:400+parseInt(a.getLang("syntaxhl.delta_height",0)),inline:1},{plugin_url:b})});a.addButton("syntaxhl",{title:"syntaxhl.desc",cmd:"mceSyntaxHL",image:b+"/img/highlight.gif"});a.onNodeChange.add(function(f,e,h){var g=f.dom.getAttrib(h,"class");e.setActive("syntaxhl",h.nodeName=="PRE"&&g.match(/wysiwyg-syntaxhl/))});a.onInit.add(function(){if(a&&a.plugins.contextmenu){a.plugins.contextmenu.onContextMenu.add(function(h,f,i){var g=a.dom.getAttrib(i,"class");if(i.nodeName=="PRE"&&g.match(/wysiwyg-syntaxhl/)){f.add({title:"Edit Code",icon:"",cmd:"mceSyntax"})}})}});a.onBeforeSetContent.add(function(f,g){var e;if(tinymce.isIE){e="\r\n"}else{e="\n"}g.content=g.content.replace(/(<p>)?(<P>)?{syntaxhighlighter ([^}]*)}/g,'<pre class="wysiwyg-syntaxhl $3">');g.content=g.content.replace(/{\/syntaxhighlighter}(<\/p>)?(<\/P>)?/g,"</pre>")});a.onPostProcess.add(function(l,g){if(g.save){if(!tinymce.isIE){var j=l.dom.select("pre.wysiwyg-syntaxhl");for(var k=0;k<j.length;k++){var e=l.dom.getAttrib(j[k],"class");matchString=l.dom.getOuterHTML(j[k]);if(tinymce.isIE){matchString=matchString.replace(/^<PRE/,"<pre");matchString=matchString.replace(/PRE>$/,"pre>")}var f=g.content.indexOf(matchString);var h=l.dom.getOuterHTML(j[k]).length;e=e.replace(/(wysiwyg-syntaxhl\s*)/g,"");var m="{syntaxhighlighter "+e+"}"+l.dom.encode(c._getText(j[k]))+"{/syntaxhighlighter}";var n=g.content.substr(0,f);var p=g.content.substr(f+h);if(f!=-1){g.content=n+m+p}}}}})},createControl:function(b,a){return null},getInfo:function(){return{longname:"Syntax Highlighter",author:"Clifford Meece",authorurl:"http://cliffordmeece.com",infourl:"http://drupal.org/project/wysiwyg_syntaxhl",version:"1.0"}},_getText:function(c){if(c.nodeType==3){return c.nodeValue}var a=new Array(),b=0;while(c.childNodes[b]){a[a.length]=this._getText(c.childNodes[b]);b++}return a.join("")}});tinymce.PluginManager.add("syntaxhl",tinymce.plugins.SyntaxHL)})();